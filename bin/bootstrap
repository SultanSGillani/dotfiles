#!/usr/bin/env bash

set -o errexit
set -o pipefail
set -o nounset

ZSH=${HOME}/dotfiles

PLAYBOOK=${HOME}/dotfiles/sudo.yml

HOSTS=${HOME}/dotfiles/inventory.yml

# Run main playbook

HOST_OS=$(uname)

cd ${ZSH}

if [[ $# -eq 0 ]]; then
  echo "Running sudo bootstrapping Playbook for ${HOST_OS}"
  if [[ "${HOST_OS}" = 'Darwin' ]] || [[ "${HOST_OS}" = 'Linux' ]]; then
  ansible-playbook -i ${HOSTS} ${PLAYBOOK} --ask-become-pass --tags bootstrap
  else
    echo "Unknown host OS: ${HOST_OS}"
    exit 1
  fi
else
    echo "Running bootstrapping Playbook for ${HOST_OS}"
  if [[ "${HOST_OS}" = 'Darwin' ]] || [[ "${HOST_OS}" = 'Linux' ]]; then
  ansible-playbook -i ${HOSTS} ${PLAYBOOK} -ask-become-pass --tags bootstrap,"$@"
  else
    echo "Unknown host OS: ${HOST_OS}"
    exit 1
  fi
fi

trap - EXIT

